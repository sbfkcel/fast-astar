/*! Project:astar, Create:FWS 2019.10.29 15:21, Update:FWS 2019.10.31 19:19 */ 
!function(){"use strict";var t=function(t){return document.getElementById(t)},e=function(t){return t.split(",").map(Number)},a=window.devicePixelRatio>1?2:1;(new(function(){function n(){this._drawText=function(t,e,n,i,r){var o=this,p=o.option,d=p.lineSize,l=p.spotSize,s=new PIXI.Container,h={fontFamily:"Arial",fontSize:8*a,fill:0,align:"left"},u=3*d;return t=new PIXI.Text(t,h),e=new PIXI.Text(e,h),n=new PIXI.Text(n,h),i=i*(l+d)+d,r=r*(l+d)+d,t.x=u,t.y=u,e.x=u,e.y=l-e.height-u+2,n.y=l-n.height-u+2,n.x=l-n.width-u,s.addChild(t),s.addChild(e),s.addChild(n),s.x=i,s.y=r,s};var t=this;t.option={lineSize:2*a},t.taskData={},t.backObj={text:{},path:undefined,highlight:undefined,graph:{}},t.domBox=document.getElementById("app"),t.domResult=document.getElementById("result"),t.domBox.oncontextmenu=function(t){return t.preventDefault(),!1},t.timer}return n.prototype.init=function(){var t=this;t.setOption(),t.createApp()},n.prototype.getCurrentTaskData=function(){var t=this,e=t.option;return t.taskData[[e.col,e.row]]},n.prototype.setOption=function(){for(var e=this,n=["grid","obstacle","rightAngle","speed","optimalResult"],i=e.option,r={},o=function(t,n){switch(t){case"grid":var r=n.split(",").map(Number),o=i.lineSize,p=void 0,d=void 0,l=void 0;p=i.col=r[0],d=i.row=r[1],e.taskData[[p,d]]=e.getCurrentTaskData()||{start:undefined,end:undefined,obstacle:undefined,list:[]},l=40===r[0]?i.spotSize=24*a:i.spotSize=48*a,i.canvasW=(l+o)*p+o,i.canvasH=(l+o)*d+o;break;case"obstacle":i[t]=+n,e.map&&(e.getCurrentTaskData().obstacle=e.map.obstacle(i.obstacle,1));break;case"speed":i[t]=+n;break;case"optimalResult":case"rightAngle":i[t]=!!+n}},p=0,d=n.length;p<d;p++)!function(a,i){var p=n[a];r[p]=t(p);var d=localStorage.getItem(p);d&&(r[p].value=d),o(p,d||r[p].value),r[p].onchange=function(){localStorage.setItem(p,this.value),o(p,this.value),e.clearDraw(),"grid"===p?e.createApp():e.drawInit()}}(p)},n.prototype.createApp=function(){var t=this,e=t.option;t.app&&t.domBox.removeChild(t.app.view),window.app=t.app=new PIXI.Application({width:e.canvasW,height:e.canvasH,antialias:!0,backgroundColor:14540253,forceCanvas:!1}),t.app.view.style.width="1002px",t.app.view.style.height="602px",t.domBox.appendChild(t.app.view);var a=t.pixiGroup={event:new PIXI.display.Group(6,!0),text:new PIXI.display.Group(5,!0),startEnd:new PIXI.display.Group(4,!0),path:new PIXI.display.Group(3,!0),highlight:new PIXI.display.Group(2,!0),graph:new PIXI.display.Group(1,!0),background:new PIXI.display.Group(0,!0)},n=t.pixiContainer={event:new PIXI.Container,text:new PIXI.Container,startEnd:new PIXI.Container,path:new PIXI.Container,highlight:new PIXI.Container,graph:new PIXI.Container,background:new PIXI.Container};t.app.stage=new PIXI.display.Stage,t.app.stage.sortableChildren=!0;for(var i in a)t.app.stage.addChild(new PIXI.display.Layer(a[i]));for(var i in n)t.app.stage.addChild(n[i]);t.drawInit()},n.prototype.render=function(t){var e=this,a=e.x,n=e.y,i=e.type,r={},o=t.option,p=t.taskData[[o.col,o.row]];if(i)switch(i){case"start":case"end":p[i]=[a,n];break;default:r[i]=[a,n]}Object.keys(r).length&&p.list.push(r)},n.prototype.drawInit=function(){var t=this,a=t.option,n=t.map=new Grid({col:a.col,row:a.row,render:function(){t.render.call(this,t)}}),i=t.getCurrentTaskData(),r=i.obstacle,o=i.start||[0,0],p=i.end||[a.col-1,a.row-1];if(r)for(var d in r)d=e(d),n.set(d,"value",1);else t.getCurrentTaskData().obstacle=n.obstacle(t.option.obstacle,1);var l=t.astar=new Astar(n),s=l.search(o,p,{rightAngle:t.option.rightAngle,optimalResult:t.option.optimalResult}),h=s?s.map(function(t){return"["+t+"]"}):"No result";t.domResult.innerHTML=h,t.domResult.className=s?"result":"result result--notResult",t.drawEventAndBackground(),t.drawStartEnd(),t.drawTask()},n.prototype.clearDraw=function(){var t=this,e=(t.option,t.pixiContainer);t.getCurrentTaskData().list=[],t.timer&&clearTimeout(t.timer);for(var a in e){var n=e[a];n.removeChildren(0,n.children.length)}},n.prototype.drawEventAndBackground=function(){for(var t=this,e=t.map,a=e.grid,n=t.getCurrentTaskData(),i=n.obstacle,r=0,o=a.length;r<o;r++)for(var p=a[r],d=0,l=p.length;d<l;d++){var s=p[d],h=s.x,u=s.y,c=0===s.value?16777215:0,g=void 0,w=void 0;g=t._drawSquare(c,h,u),g.parentGroup=t.pixiGroup.background,t.pixiContainer.background.addChild(g),w=t._drawSquare(c,h,u),w.xy=[h,u],w.interactive=!0,w.cursor="pointer",w.alpha=0,w.parentGroup=t.pixiGroup.event,t.pixiContainer.event.addChild(w),w.mousedown=function(e){n.start=n.end,n.end=this.xy,t.clearDraw(),t.drawInit()},w.rightdown=function(e){null===i[this.xy]?delete i[this.xy]:i[this.xy]===undefined&&(i[this.xy]=null),t.clearDraw(),t.drawInit()}}},n.prototype.drawStartEnd=function(){var t=this,e=t.getCurrentTaskData();[e.start,e.end].forEach(function(e,a){var n=a?32767:16711680,i=e[0],r=e[1],o=t._drawRound(n,i,r);o.parentGroup=t.pixiGroup.startEnd,t.pixiContainer.startEnd.addChild(o)})},n.prototype.drawTask=function(){var t,e,a=this,n=a.option,i=a.getCurrentTaskData().list,r=a.astar,o=a.backObj,p=a.pixiContainer,d=a.pixiGroup,l={children:!0,texture:!0,baseTexture:!0};(e=function(s){if((t=i.length)>s){var h=i[s],u=function(){for(var t in h){var i=h[t],u=i[0],c=i[1],g=r.grid.get(i),w=void 0,v=void 0,I=void 0,f=void 0,y=void 0;if(i&&"time"!==t)switch("open"!==t&&"update"!==t||20!==n.col||(I=g.f,f=g.g,y=g.h,I&&(o.text[i]&&(o.text[i].destroy(l),p.text.removeChild(o.text[i])),v=o.text[i]=a._drawText(I,f,y,u,c),v.parentGroup=d.text,p.text.addChild(v))),t){case"open":case"close":w="open"===t?13959136:60854,o.graph[i]&&(o.graph[i].destroy(l),p.graph.removeChild(o.graph[i])),v=o.graph[i]=a._drawSquare(w,u,c),v.parentGroup=d.graph,p.graph.addChild(v);break;case"highlight":w=0,o.highlight&&(o.highlight.destroy(l),p.highlight.removeChild(o.highlight)),v=o.highlight=a._drawBorder(w,u,c),v.parentGroup=d.highlight,p.highlight.addChild(v);var x=r.getBackPath(i);x.length>1&&(w=16776960,o.path&&(o.path.destroy(l),p.path.removeChild(o.path)),v=o.path=a._drawPath(w,x),v.parentGroup=d.path,p.path.addChild(v))}}e(++s)};s<t&&(a.timer=setTimeout(u,n.speed))}})(0)},n.prototype._drawSquare=function(t,e,a){var n=this,i=n.option,r=i.spotSize,o=i.lineSize,p=new PIXI.Graphics;return p.clear(),p.beginFill(t),p.drawRect(e*(r+o)+o,a*(r+o)+o,r,r),p.endFill(),p},n.prototype._drawRound=function(t,e,a){var n=this,i=n.option,r=i.spotSize,o=i.lineSize,p=new PIXI.Graphics,d=r/4,l=r/2+o+e*(r+o),s=r/2+o+a*(r+o);return p.clear(),p.beginFill(t),p.drawCircle(l,s,d),p.endFill(),p},n.prototype._drawBorder=function(t,e,a){var n=this,i=n.option,r=i.spotSize,o=i.lineSize,p=new PIXI.Graphics,d=~~(r/10);return p.clear(),p.lineStyle(d,t,.3,0),p.beginFill(t,0),p.drawRect(e*(r+o)+o,a*(r+o)+o,r,r),p.endFill(),p},n.prototype._drawPath=function(t,e){var a=this,n=a.option,i=n.spotSize,r=n.lineSize,o=n.canvasW,p=n.canvasH,d=i/4,l=d/2,s=document.createElement("canvas"),h=s.getContext("2d"),u=function(t,e,a,n,i){t.beginPath(),t.arc(e,a,n,0,2*Math.PI),t.fillStyle=i,t.fill()};t="#"+t.toString(16),s.width=o,s.height=p,s.style.background="orange",e.forEach(function(a,n){var o=a[0]*i+i/2+a[0]*r+r,p=a[1]*i+i/2+a[1]*r+r;0===n?(u(h,o,p,l,t),h.beginPath(),h.lineWidth=d,h.lineJoin="round",h.strokeStyle=t,h.moveTo(o,p)):h.lineTo(o,p),n===e.length-1&&(h.stroke(),u(h,o,p,l,t))});var c=new PIXI.Sprite(new PIXI.Texture(new PIXI.BaseTexture.fromCanvas(s),new PIXI.Rectangle(0,0,o,p)));return c.alpha=.8,c},n}())).init()}();